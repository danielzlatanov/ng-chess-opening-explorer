<div class="openings-catalog">
  <div class="container">
    <h2 class="title">Browse Catalog</h2>
    <mat-slide-toggle [checked]="isDynamicSearch" (change)="toggleSearchMode()">
      <span>{{ isDynamicSearch == true ? "Dynamic" : "Manual" }} Search </span>
    </mat-slide-toggle>
    <div class="search-bar">
      <input
        #searchInput
        type="text"
        [(ngModel)]="searchQuery"
        [placeholder]="
          isDynamicSearch == true ? 'Search as you type' : 'Search openings'
        "
        (keydown.enter)="searchHandler()"
        (input)="isDynamicSearch && searchHandler()"
      />
      <div
        class="tooltip-container"
        matTooltip="Press '/' to focus the search field"
      >
        <div class="slash-indicator" *ngIf="isDynamicSearch">/</div>
      </div>
      <button type="button" (click)="searchHandler()" *ngIf="!isDynamicSearch">
        Search
      </button>
    </div>
  </div>

  <ng-container *ngIf="isLoading; else openingsData">
    <app-loader></app-loader>
  </ng-container>

  <ng-template #openingsData>
    <div class="openings-grid" *ngIf="filteredOpenings">
      <div
        class="opening-card"
        *ngFor="let opening of filteredOpenings; let i = index"
  <div
    class="search-bar flex justify-center items-center m-6"
    [ngClass]="{
      'pointer-events-none opacity-40': showNoOpeningsMsg || isLoading
    }"
  >
    <input
      #searchInput
      type="text"
      class="w-96"
      [(ngModel)]="searchQuery"
      [placeholder]="
        isDynamicSearch == true ? 'Search as you type' : 'Search openings'
      "
      (keydown.enter)="searchHandler()"
      (input)="isDynamicSearch && searchHandler()"
    />
    <div
      matTooltip="Press '/' to focus the search field"
      class="ml-2 w-3 h-4 p-3 hidden lg:flex items-center justify-center bg-white rounded-md"
      *ngIf="isDynamicSearch"
    >
      <div class="">/</div>
    </div>
    <button
      type="button"
      class="ml-2"
      (click)="searchHandler()"
      *ngIf="!isDynamicSearch"
    >
      <svg
        class="w-3 h-3"
        aria-hidden="true"
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 20 20"
      >
        <div class="opening-image">
          <img [src]="randomChessPieceImgs[i]" alt="Opening {{ i + 1 }}" />
        </div>
        <path
          stroke="currentColor"
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="m19 19-4-4m0-7A7 7 0 1 1 1 8a7 7 0 0 1 14 0Z"
        />
      </svg>
    </button>
  </div>

        <div class="opening-details">
          <h2 class="opening-title">
            {{ opening.name | slice : 0 : 16 }}
            {{ opening.name.length > 16 ? "..." : "" }}
          </h2>
          <p class="opening-description">
            {{ opening.description | slice : 0 : 20 }}
            {{ opening.description.length > 20 ? "..." : "" }}
          </p>
          <a
            mat-stroked-button
            class="view-details"
            routerLink="/openings/details/{{ opening.id }}"
            >Details</a
          >
        </div>
      </div>
    </div>
  </ng-template>

  <div class="no-results-message" *ngIf="showNoResultsMsg">
    <p class="message">
      No matching openings found. Please try a different search query.
    </p>
  </div>

  <div class="no-openings-message" *ngIf="showNoOpeningsMsg">
    <app-no-openings-msg
      [message]="
        'No chess openings available at the moment. We\'re constantly updating, so please come back later.'
      "
      [imageUrl]="'/assets/images/coming-soon.png'"
    ></app-no-openings-msg>
  </div>
</div>
